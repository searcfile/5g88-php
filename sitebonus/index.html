<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bonus Files Manager</title>
<style>
  :root{
    --bg:#0a0a0a; --panel:#101010; --line:#262626; --muted:#b3b3b3;
    --gold:#ffd24d; --gold2:#ffea9a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:inherit}
  /* HEADER */
  .header{position:sticky;top:0;z-index:40;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);border-bottom:1px solid var(--line)}
  .h-inner{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:10px;margin-right:auto}
  .brand .logo{width:36px;height:20px;border-radius:999px;background:linear-gradient(90deg,var(--gold2),var(--gold));box-shadow:0 0 14px 3px rgba(255,210,77,.35)}
  .brand .title{font-weight:800;letter-spacing:.3px}
  .filters{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#141414;color:#e8e8e8;cursor:pointer;font-size:14px}
  .chip:hover{border-color:var(--gold)}
  .chip.active{background:linear-gradient(180deg,var(--gold2),var(--gold));color:#111;border-color:#b98e00;box-shadow:0 0 0 3px rgba(255,210,77,.15)}
  /* BAR */
  .bar{max-width:1100px;margin:12px auto 0;padding:0 16px 12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .search{flex:1;display:flex;align-items:center;gap:8px;background:#0f0f0f;border:1px solid var(--line);border-radius:10px;padding:8px 10px}
  .search input{flex:1;background:transparent;border:none;outline:none;color:#fff;font-size:14px}
  .btn{appearance:none;border:none;border-radius:10px;padding:9px 12px;background:#161616;color:#fff;border:1px solid var(--line);cursor:pointer;font-weight:600}
  .btn:hover{border-color:var(--gold)}
  .btn.gold{background:linear-gradient(180deg,var(--gold2),var(--gold));color:#111;border-color:#b98e00}
  .count{font-size:12px;color:var(--muted)}
  /* GRID */
  .wrap{max-width:1100px;margin:10px auto 40px;padding:0 16px}
  .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  @media (max-width:820px){.grid{grid-template-columns:1fr}}
  .card{display:flex;gap:12px;background:linear-gradient(180deg,#111,#0a0a0a);border:1px solid var(--line);border-radius:12px;padding:12px}
  .thumb{width:86px;height:64px;border:1px solid #333;border-radius:8px;background:#0f0f0f;display:flex;align-items:center;justify-content:center;overflow:hidden;flex:0 0 auto}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .thumb .pdf{font-weight:800;font-size:20px}
  .meta{flex:1 1 auto;min-width:0}
  .name{font-weight:700;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .sub{margin-top:4px;font-size:12px;color:#d9d9d9;display:flex;gap:8px;flex-wrap:wrap}
  .badge{padding:2px 8px;border-radius:999px;font-size:11px;color:#111;background:linear-gradient(180deg,var(--gold2),var(--gold));border:1px solid #b98e00}
  .note{color:#bcbcbc}
  .actions{display:flex;gap:8px}
  .empty{margin-top:12px;text-align:center;padding:24px;border:1px dashed var(--line);border-radius:12px;color:var(--muted)}
  /* DIALOG */
  dialog{border:none;border-radius:14px;padding:0;background:#0f0f0f;color:#fff;max-width:520px;width:calc(100% - 24px)}
  dialog::backdrop{background:rgba(0,0,0,.55)}
  .dlg-h{padding:14px 16px;border-bottom:1px solid #222;font-weight:800}
  .dlg-b{padding:16px;display:grid;gap:10px}
  .row{display:grid;gap:6px}
  input[type="text"], select, textarea{background:#101010;border:1px solid #2a2a2a;border-radius:10px;color:#fff;padding:10px 12px;outline:none}
  textarea{min-height:70px;resize:vertical}
  .filebox{border:1px dashed #3a3a3a;border-radius:10px;padding:14px;text-align:center}
  .dlg-f{display:flex;gap:10px;justify-content:flex-end;border-top:1px solid #222;padding:12px 16px}
  .note-sm{font-size:12px;color:var(--muted)}
  /* TOAST */
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:#111827;color:#e5e7eb;padding:12px 16px;border-radius:10px;border:1px solid #233044;display:none;z-index:50}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="h-inner">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="title">Bonus Files</div>
        <div style="font-size:12px;color:#bdbdbd">Multi Sub‑Account (5G88, SPM888, …)</div>
      </div>
    </div>
    <div class="filters" id="filters"></div>
  </div>
</div>

<!-- BAR -->
<div class="bar">
  <div class="search">
    <input id="q" placeholder="Cari nama file… (cth: Superman, Welcome Bonus, 02/09)">
    <button class="btn" id="clearBtn" title="Clear search">✕</button>
  </div>
  <button class="btn gold" id="addBtn">+ Add File</button>
  <button class="btn" id="exportBtn">Export JSON</button>
  <label class="btn" for="importFile" style="cursor:pointer">Import JSON</label>
  <input id="importFile" type="file" accept=".json" hidden>
  <div class="count" id="count">0 files</div>
</div>

<!-- GRID -->
<div class="wrap">
  <div class="grid" id="grid"></div>
  <div class="empty" id="empty" style="display:none">Belum ada file. Klik <b>+ Add File</b> untuk menambah.</div>
</div>

<!-- ADD DIALOG -->
<dialog id="dlg">
  <div class="dlg-h">Tambah / Simpan Bonus File</div>
  <form method="dialog" id="form">
    <div class="dlg-b">
      <div class="row">
        <label>Site / Sub Account</label>
        <div style="display:flex;gap:8px">
          <select id="site"></select>
          <input id="newSite" type="text" placeholder="atau ketik site baru (mis: SPM888)">
        </div>
      </div>
      <div class="row">
        <label>Nama file (judul)</label>
        <input id="name" type="text" placeholder="Contoh: Superman Bonus 02/09/2025" required>
      </div>
      <div class="row">
        <label>Upload file (gambar/PDF)</label>
        <div class="filebox">
          <input id="file" type="file" accept="image/*,.pdf">
          <div class="note-sm">Gambar akan dipratinjau. PDF disimpan dengan ikon.</div>
        </div>
      </div>
      <div class="row">
        <label>Catatan (opsional)</label>
        <textarea id="note" placeholder="Contoh: Banner harian, format Superman…"></textarea>
      </div>
    </div>
    <div class="dlg-f">
      <button class="btn" value="cancel">Cancel</button>
      <button class="btn gold" id="saveBtn" value="default">Save</button>
    </div>
  </form>
</dialog>

<div class="toast" id="toast">Saved</div>

<script>
/* ================== STORAGE & STATE ================== */
const LS_KEY = 'bonusFiles.v1';
/** shape:
 * {id, site, name, mime, url, createdAt, note}
 * url: blob url (session) + dataUrl (persist) -> we store dataUrl (base64) for persistence
 */
let items = load();
let activeSite = '_ALL_';
let query = '';

const els = {
  filters: document.getElementById('filters'),
  grid: document.getElementById('grid'),
  empty: document.getElementById('empty'),
  count: document.getElementById('count'),
  q: document.getElementById('q'),
  clearBtn: document.getElementById('clearBtn'),
  addBtn: document.getElementById('addBtn'),
  dlg: document.getElementById('dlg'),
  form: document.getElementById('form'),
  site: document.getElementById('site'),
  newSite: document.getElementById('newSite'),
  name: document.getElementById('name'),
  file: document.getElementById('file'),
  note: document.getElementById('note'),
  saveBtn: document.getElementById('saveBtn'),
  toast: document.getElementById('toast'),
  exportBtn: document.getElementById('exportBtn'),
  importFile: document.getElementById('importFile'),
};

/* ================== INIT ================== */
init();
function init(){
  renderFilterChips();
  render();
  els.addBtn.onclick = openDialog;
  els.clearBtn.onclick = ()=>{ els.q.value=''; query=''; render(); };
  els.q.oninput = ()=>{ query = els.q.value.trim().toLowerCase(); render(); };
  window.addEventListener('keydown', e=>{ if(e.key==='/' && !isTyping()){ e.preventDefault(); els.q.focus(); }});
  els.form.addEventListener('submit', handleSave);
  els.exportBtn.onclick = exportJSON;
  els.importFile.onchange = importJSON;
}

/* ================== RENDER ================== */
function renderFilterChips(){
  const sitesFromData = [...new Set(items.map(x=>x.site))].sort((a,b)=>a.localeCompare(b));
  els.filters.innerHTML = '';
  const make = (id,label)=>{
    const b = document.createElement('button');
    b.className = 'chip';
    b.dataset.id = id;
    b.textContent = label;
    b.onclick = ()=>{ activeSite = id; updateActive(); render(); };
    return b;
  };
  els.filters.appendChild(make('_ALL_','ALL'));
  sitesFromData.forEach(s=> els.filters.appendChild(make(s,s)));
  updateActive();
}
function updateActive(){
  [...els.filters.children].forEach(ch=> ch.classList.toggle('active', ch.dataset.id===activeSite));
}

function render(){
  const data = getFiltered();
  els.grid.innerHTML = '';
  els.count.textContent = `${data.length} file${data.length!==1?'s':''}`;
  if(!data.length){ els.empty.style.display='block'; els.grid.style.display='none'; return; }
  els.empty.style.display='none'; els.grid.style.display='grid';
  data.forEach(item => els.grid.appendChild(card(item)));
}

function card(it){
  const c = document.createElement('div'); c.className='card';

  const th = document.createElement('div'); th.className='thumb';
  if((it.mime||'').includes('image/')){
    const img = new Image(); img.src = it.url; th.appendChild(img);
  }else{
    const d = document.createElement('div'); d.className='pdf'; d.textContent='PDF'; th.appendChild(d);
  }

  const meta = document.createElement('div'); meta.className='meta';
  const name = document.createElement('div'); name.className='name'; name.textContent = it.name || '(no name)';
  const sub = document.createElement('div'); sub.className='sub';
  const b = document.createElement('span'); b.className='badge'; b.textContent = it.site;
  const dt = document.createElement('span'); dt.textContent = '• ' + fmtDate(it.createdAt);
  const note = document.createElement('span'); note.className='note'; if(it.note) note.textContent = '• ' + it.note;
  sub.append(b, dt); if(it.note) sub.append(note);

  const acts = document.createElement('div'); acts.className='actions';
  const open = button('Open', ()=> openItem(it));
  const copy = button('Copy Link', async ()=> {
    try{ await navigator.clipboard.writeText(it.url); toast('Link copied'); }catch{ toast('Copy failed'); }
  });
  const del = button('Delete', ()=> deleteItem(it.id));
  acts.append(open, copy, del);

  meta.append(name, sub);
  c.append(th, meta, acts);
  return c;
}
function button(label, fn){
  const x = document.createElement('button');
  x.className = label==='Copy Link' ? 'btn gold' : 'btn';
  if(label==='Open') x.classList.add('open');
  x.textContent = label;
  x.onclick = fn;
  return x;
}

/* ================== DIALOG ================== */
function openDialog(){
  // build site dropdown from current sites; also add suggestions
  const sites = [...new Set(items.map(x=>x.site))]; // existing
  const defaults = ['5G88','SPM888'];
  const all = [...new Set([...defaults, ...sites])].sort((a,b)=>a.localeCompare(b));
  els.site.innerHTML = all.map(s=>`<option value="${s}">${s}</option>`).join('');
  els.newSite.value = '';
  els.name.value = '';
  els.file.value = '';
  els.note.value = '';
  els.dlg.showModal();
}
async function handleSave(e){
  e.preventDefault();
  let site = (els.newSite.value.trim()) || els.site.value;
  if(!site){ toast('Isi site'); return; }
  const name = els.name.value.trim();
  if(!name){ toast('Isi nama file'); return; }
  const f = els.file.files[0];
  if(!f){ toast('Pilih file'); return; }
  const mime = f.type || '';
  const dataUrl = await fileToDataUrl(f); // persist
  const item = {
    id: randomId(),
    site,
    name,
    mime,
    url: dataUrl,
    createdAt: Date.now(),
    note: els.note.value.trim()
  };
  items.unshift(item);
  save(); render(); renderFilterChips();
  els.dlg.close();
  toast('Saved');
}

/* ================== FILTER ================== */
function getFiltered(){
  let arr = items.slice();
  if(activeSite !== '_ALL_') arr = arr.filter(x=> x.site === activeSite);
  if(query) arr = arr.filter(x=> (x.name||'').toLowerCase().includes(query));
  return arr;
}

/* ================== ACTIONS ================== */
function openItem(it){
  // create blob to open in new tab (works for image & pdf)
  const a = document.createElement('a');
  a.href = it.url; a.target = '_blank'; a.rel='noopener';
  a.click();
}
function deleteItem(id){
  if(!confirm('Delete file ini?')) return;
  items = items.filter(x=> x.id!==id);
  save(); render();
}

/* ================== UTILS ================== */
function load(){
  try{ return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); }catch{ return []; }
}
function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(items));
}
function fmtDate(ts){
  try{
    const d = new Date(ts);
    const dd = String(d.getDate()).padStart(2,'0');
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const yyyy = d.getFullYear();
    const hh = String(d.getHours()).padStart(2,'0');
    const min = String(d.getMinutes()).padStart(2,'0');
    return `${dd}/${mm}/${yyyy} ${hh}:${min}`;
  }catch{ return ''; }
}
function isTyping(){
  const a=document.activeElement; return a && (a.tagName==='INPUT' || a.tagName==='TEXTAREA');
}
function randomId(){ return Math.random().toString(36).slice(2)+Date.now().toString(36); }
function fileToDataUrl(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }
function toast(msg){
  const t=els.toast; t.textContent=msg; t.style.display='block'; t.style.opacity='0';
  requestAnimationFrame(()=>{ t.style.transition='opacity .2s'; t.style.opacity='1'; });
  setTimeout(()=>{ t.style.opacity='0'; setTimeout(()=>t.style.display='none',220); },1300);
}

/* ================== EXPORT / IMPORT ================== */
function exportJSON(){
  const blob = new Blob([JSON.stringify(items,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='bonus-files.json'; a.click();
  setTimeout(()=>URL.revokeObjectURL(url),500);
}
function importJSON(e){
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    try{
      const data=JSON.parse(r.result||'[]');
      if(!Array.isArray(data)) throw new Error('bad json');
      // merge (new first); avoid dup by id
      const ids = new Set(items.map(x=>x.id));
      const add = data.filter(x=>x && x.id && !ids.has(x.id));
      items = [...add, ...items];
      save(); render(); renderFilterChips();
      toast('Imported');
    }catch(err){ toast('Import failed'); }
  };
  r.readAsText(f);
  e.target.value = '';
}
</script>
</body>
</html>
