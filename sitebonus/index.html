<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>5G88 | Transactions</title>
<style>
  :root{
    --bg:#0b0b0b;
    --panel:#121212;
    --panel-2:#151515;
    --text:#eaeaea;
    --muted:#9aa0a6;
    --line:#262626;
    --gold:#f1c232;
    --gold-2:#ffd54d;
    --blue:#2b6cb0;
    --danger:#f87171;
    --ok:#22c55e;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font-family: ui-sans-serif,system-ui,"Segoe UI",Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* Header */
  .app-header{
    height:56px; background:#0f172a; color:#fff;
    display:flex; align-items:center; justify-content:space-between;
    padding:0 14px; position:sticky; top:0; z-index:50; border-bottom:1px solid #111827;
  }
  .brand{display:flex;gap:10px;align-items:center;font-weight:700}
  .brand .dot{width:8px;height:8px;border-radius:50%;background:var(--gold)}
  .tabs{display:flex;gap:8px;align-items:center}
  .tab{
    padding:8px 12px; border-radius:8px; cursor:pointer; user-select:none;
    color:#c7d2fe; border:1px solid transparent;
  }
  .tab.active{background:#111827;border-color:#1f2937;color:#fff}
  .meter{display:flex;gap:8px;align-items:center;font-size:12px;color:#cbd5e1}
  .pill{padding:3px 8px;border-radius:999px;background:#0b1220;border:1px solid #1f2937}

  /* Toolbar under header */
  .toolbar{
    position:sticky; top:56px; z-index:45;
    background:var(--panel); border-bottom:1px solid var(--line);
    padding:10px 12px; display:grid; gap:10px;
    grid-template-columns: 1fr auto auto auto;
  }
  @media (max-width:980px){
    .toolbar{grid-template-columns: 1fr 1fr}
  }
  .search-wrap{display:flex; gap:8px; align-items:center}
  .search{
    height:36px; background:#0f0f0f; border:1px solid #303030; color:#fff;
    border-radius:8px; padding:0 10px; width:260px; outline:none;
  }
  .search:focus{border-color:var(--gold)}
  .daterange{display:flex; gap:8px}
  .date{
    height:36px; background:#0f0f0f; border:1px solid #303030; color:#fff;
    border-radius:8px; padding:0 10px; outline:none; width:175px;
  }
  .select{
    height:36px; background:#0f0f0f; border:1px solid #303030; color:#fff;
    border-radius:8px; padding:0 10px; outline:none;
  }
  .btn{
    height:36px; padding:0 14px; border-radius:8px; border:1px solid #1f2937;
    background:#0d1b2a; color:#cbd5e1; cursor:pointer; transition:.18s;
  }
  .btn:hover{filter:brightness(1.15)}
  .btn.gold{background:linear-gradient(180deg,var(--gold-2),var(--gold)); color:#1b1b1b; border-color:#8f6f00; font-weight:700}
  .btn.ghost{background:#111827;color:#e5e7eb}
  .btn.danger{background:#2a0f10;color:#fecaca;border-color:#7f1d1d}
  .toolbar .right{display:flex; gap:8px; align-items:center; justify-self:end}

  /* Content */
  .content{padding:12px}
  .card{
    background:var(--panel-2); border:1px solid var(--line); border-radius:12px; overflow:hidden;
  }
  .table{
    width:100%; border-collapse:separate; border-spacing:0;
  }
  .thead{background:#0f0f0f; color:#cbd5e1}
  .thead th{font-size:12px; text-transform:uppercase; letter-spacing:.04em}
  th, td{padding:10px 12px; border-bottom:1px solid #1f1f1f; vertical-align:top}
  tr:hover td{background:#121820}
  .empty{padding:40px; text-align:center; color:#8a8f98}
  .badge{padding:2px 8px; border-radius:999px; font-size:12px; background:#0b1220; border:1px solid #1f2937; color:#cbd5e1}
  .muted{color:var(--muted); font-size:12px}
  .num{font-variant-numeric:tabular-nums}
  .actions{display:flex; gap:6px}
  .link{color:#93c5fd; cursor:pointer}
  .detail-on td:nth-child(n+5){white-space:nowrap}

  /* Modal */
  .modal-backdrop{
    position:fixed; inset:0; background:rgba(0,0,0,.6);
    display:none; align-items:center; justify-content:center; z-index:60;
  }
  .modal{width:min(860px,96vw); background:#0e0e0e; border:1px solid var(--line); border-radius:14px; overflow:hidden}
  .modal header{display:flex; justify-content:space-between; align-items:center; padding:12px 14px; background:#111827; border-bottom:1px solid #1f2937}
  .modal h3{margin:0; font-size:16px}
  .modal .body{padding:14px}
  .grid{
    display:grid; gap:10px;
    grid-template-columns: repeat(3,minmax(0,1fr));
  }
  @media (max-width:860px){ .grid{grid-template-columns:1fr 1fr} }
  @media (max-width:560px){ .grid{grid-template-columns:1fr} }
  .field{display:flex; flex-direction:column; gap:6px}
  .label{font-size:12px; color:#cbd5e1}
  .input,.number{
    height:36px; background:#0f0f0f; border:1px solid #303030; color:#fff;
    border-radius:8px; padding:0 10px; outline:none;
  }
  .input:focus,.number:focus{border-color:var(--gold)}
  .modal footer{display:flex; gap:10px; justify-content:flex-end; padding:12px 14px; border-top:1px solid #1f2937; background:#0f0f0f}
  .hint{font-size:12px; color:#9aa0a6}

  /* Toast */
  .toast{
    position:fixed; bottom:24px; left:50%; transform:translateX(-50%);
    background:#111827; color:#e5e7eb; border:1px solid #1f2937; border-radius:10px;
    padding:10px 14px; font-size:14px; display:none; z-index:70;
  }
</style>
</head>
<body>

  <!-- Header -->
  <div class="app-header">
    <div class="brand"><span class="dot"></span> <span>5G88 Admin</span></div>
    <div class="tabs">
      <div class="tab">Dashboard</div>
      <div class="tab active">Transactions</div>
      <div class="tab">Cash Transfer</div>
      <div class="tab">Player</div>
      <div class="tab">Livechat</div>
    </div>
    <div class="meter">
      <span class="pill">Kuala_Lumpur</span>
      <span class="pill">Bank Meter: <b class="num" id="meterTotal">4,775,613.48</b></span>
      <span class="pill">Online: <b id="onlineCount">536</b></span>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar" id="toolbar">
    <div class="search-wrap">
      <input id="siteSearch" class="search" placeholder="Search Site (e.g. 5g88, spm888)" autocomplete="off" />
      <button class="btn ghost" id="clearSiteBtn">Clear</button>
    </div>

    <div class="daterange">
      <input type="datetime-local" id="fromDate" class="date" />
      <input type="datetime-local" id="toDate" class="date" />
    </div>

    <div class="right">
      <button class="btn" id="sortBtn" title="Toggle Date Desc/Asc">Date Descend</button>
      <button class="btn" id="detailBtn">Detail View</button>
    </div>

    <div class="right">
      <button class="btn gold" id="createBtn">Create</button>
    </div>
  </div>

  <!-- Content -->
  <div class="content">
    <div class="card">
      <table class="table" id="txTable">
        <thead class="thead">
          <tr>
            <th style="width:160px">Date</th>
            <th>Site</th>
            <th>Total Deposit</th>
            <th>Total Withdrawal</th>
            <th>Total Bonus</th>
            <th>Total Forfeit</th>
            <th>Total Resit In</th>
            <th>Total Member</th>
            <th>Total Sales</th>
            <th style="width:130px">Action</th>
          </tr>
        </thead>
        <tbody id="txBody">
          <tr><td colspan="10" class="empty">No data</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <header>
        <h3 id="modalTitle">Create Transaction</h3>
        <button class="btn danger" id="closeModal">Close</button>
      </header>
      <div class="body">
        <div class="grid">
          <div class="field">
            <label class="label">Site <span class="hint">(contoh: 5g88, spm888)</span></label>
            <input id="mSite" class="input" placeholder="5g88" />
          </div>
          <div class="field">
            <label class="label">Date & Time</label>
            <input id="mDate" type="datetime-local" class="input" />
          </div>
          <div class="field">
            <label class="label">Total Deposit</label>
            <input id="mDeposit" type="number" step="0.01" class="number" value="0">
          </div>

          <div class="field">
            <label class="label">Total Withdrawal</label>
            <input id="mWithdrawal" type="number" step="0.01" class="number" value="0">
          </div>
          <div class="field">
            <label class="label">Total Bonus</label>
            <input id="mBonus" type="number" step="0.01" class="number" value="0">
          </div>
          <div class="field">
            <label class="label">Total Forfeit</label>
            <input id="mForfeit" type="number" step="0.01" class="number" value="0">
          </div>

          <div class="field">
            <label class="label">Total Resit In</label>
            <input id="mResit" type="number" step="0.01" class="number" value="0">
          </div>
          <div class="field">
            <label class="label">Total Member</label>
            <input id="mMember" type="number" step="1" class="number" value="0">
          </div>
          <div class="field">
            <label class="label">Total Sales <span class="hint">(boleh diisi manual)</span></label>
            <input id="mSales" type="number" step="0.01" class="number" value="0">
          </div>
        </div>

        <div style="margin-top:8px" class="hint">
          Tip: Kalau mau auto hitung <b>Total Sales</b>, klik tombol <i>Auto-calc</i> sebelum Save.
          Rumus standar: <code>Deposit - Withdrawal + Bonus - Forfeit + Resit In</code>
        </div>
      </div>
      <footer>
        <button class="btn" id="autoCalc">Auto-calc Sales</button>
        <span style="flex:1"></span>
        <button class="btn ghost" id="resetForm">Reset</button>
        <button class="btn gold" id="saveModal">Save</button>
      </footer>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  const KEY = 'tx_records_v1';

  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));
  const fmt = n => Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  const byId = id => document.getElementById(id);

  const txBody = byId('txBody');
  const siteSearch = byId('siteSearch');
  const clearSiteBtn = byId('clearSiteBtn');
  const sortBtn = byId('sortBtn');
  const detailBtn = byId('detailBtn');
  const fromDate = byId('fromDate');
  const toDate = byId('toDate');

  const modalBackdrop = byId('modalBackdrop');
  const closeModal = byId('closeModal');
  const createBtn = byId('createBtn');
  const saveModal = byId('saveModal');
  const resetForm = byId('resetForm');
  const autoCalc = byId('autoCalc');
  const modalTitle = byId('modalTitle');

  const mSite = byId('mSite');
  const mDate = byId('mDate');
  const mDeposit = byId('mDeposit');
  const mWithdrawal = byId('mWithdrawal');
  const mBonus = byId('mBonus');
  const mForfeit = byId('mForfeit');
  const mResit = byId('mResit');
  const mMember = byId('mMember');
  const mSales = byId('mSales');

  const toast = byId('toast');
  let sortDesc = true;
  let detailOn = false;
  let editingId = null;
  let records = load();

  // Seed example if empty
  if (!records.length){
    const now = new Date();
    records = [
      seed('5g88', now, 12000, 8000, 500, 200, 300, 122, 4500),
      seed('spm888', new Date(now.getTime()-86400000), 9000, 7000, 200, 0, 150, 97, 2350),
      seed('5g88', new Date(now.getTime()-3600_000*6), 15000, 6000, 1000, 100, 200, 140, 10200),
    ];
    persist();
  }

  render();

  function seed(site, dt, dep, wdw, bon, forf, resit, mem, sales){
    return {
      id: cryptoRandom(),
      site,
      date: toInputValue(dt),
      deposit: +dep, withdrawal: +wdw,
      bonus: +bon, forfeit: +forf, resit: +resit,
      member: +mem, sales: +sales
    };
  }

  function cryptoRandom(){
    if (window.crypto?.getRandomValues){
      const a = new Uint32Array(4); crypto.getRandomValues(a);
      return [...a].map(x=>x.toString(16)).join('');
    }
    return String(Date.now())+Math.random().toString(16).slice(2);
  }

  function toInputValue(d){
    const pad=n=>String(n).padStart(2,'0');
    const dt = new Date(d);
    const y=dt.getFullYear(), m=pad(dt.getMonth()+1), da=pad(dt.getDate());
    const h=pad(dt.getHours()), mi=pad(dt.getMinutes());
    return `${y}-${m}-${da}T${h}:${mi}`;
  }

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : [];
    }catch{ return [] }
  }
  function persist(){ localStorage.setItem(KEY, JSON.stringify(records)); }

  function showToast(msg){
    toast.textContent = msg;
    toast.style.display='block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.style.display='none', 1800);
  }

  function openModal(editId=null){
    editingId = editId;
    modalTitle.textContent = editId ? 'Edit Transaction' : 'Create Transaction';
    modalBackdrop.style.display='flex';
    if (!editId){
      // default values
      mSite.value = siteSearch.value.trim();
      mDate.value = toInputValue(new Date());
      mDeposit.value = mWithdrawal.value = mBonus.value =
      mForfeit.value = mResit.value = mSales.value = 0;
      mMember.value = 0;
    }
  }
  function closeModalFn(){
    modalBackdrop.style.display='none';
  }

  function readForm(){
    return {
      site: mSite.value.trim(),
      date: mDate.value || toInputValue(new Date()),
      deposit: +mDeposit.value||0,
      withdrawal: +mWithdrawal.value||0,
      bonus: +mBonus.value||0,
      forfeit: +mForfeit.value||0,
      resit: +mResit.value||0,
      member: +mMember.value||0,
      sales: +mSales.value||0,
    };
  }

  function autoCalcSales(){
    const d = +mDeposit.value||0;
    const w = +mWithdrawal.value||0;
    const b = +mBonus.value||0;
    const f = +mForfeit.value||0;
    const r = +mResit.value||0;
    mSales.value = (d - w + b - f + r).toFixed(2);
    showToast('Total Sales auto-calculated');
  }

  function saveRecord(){
    const v = readForm();
    if (!v.site){
      showToast('Site wajib diisi');
      mSite.focus(); return;
    }
    if (editingId){
      const idx = records.findIndex(r=>r.id===editingId);
      if (idx>=0){ records[idx] = {...records[idx], ...v}; }
      showToast('Transaction updated');
    }else{
      records.push({ id: cryptoRandom(), ...v });
      showToast('Transaction saved');
    }
    persist();
    closeModalFn();
    render();
  }

  function editRecord(id){
    const r = records.find(x=>x.id===id);
    if (!r) return;
    mSite.value = r.site;
    mDate.value = r.date;
    mDeposit.value = r.deposit;
    mWithdrawal.value = r.withdrawal;
    mBonus.value = r.bonus;
    mForfeit.value = r.forfeit;
    mResit.value = r.resit;
    mMember.value = r.member;
    mSales.value = r.sales;
    openModal(id);
  }

  function deleteRecord(id){
    if (!confirm('Delete this record?')) return;
    records = records.filter(r=>r.id!==id);
    persist();
    render();
  }

  function render(){
    // filters
    const site = siteSearch.value.trim().toLowerCase();
    const from = fromDate.value ? new Date(fromDate.value).getTime() : null;
    const to = toDate.value ? new Date(toDate.value).getTime() : null;

    let list = records.slice();
    if (site) list = list.filter(r=> r.site.toLowerCase().includes(site));
    if (from!=null) list = list.filter(r=> new Date(r.date).getTime() >= from);
    if (to!=null) list = list.filter(r=> new Date(r.date).getTime() <= to);

    list.sort((a,b)=>{
      const ta = new Date(a.date).getTime(), tb = new Date(b.date).getTime();
      return sortDesc ? tb-ta : ta-tb;
    });

    txBody.innerHTML = '';
    if (!list.length){
      txBody.innerHTML = `<tr><td colspan="10" class="empty">No data</td></tr>`;
      return;
    }

    for (const r of list){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="num">
          <div>${r.date.replace('T',' ')}</div>
          <div class="muted">${new Date(r.date).toDateString()}</div>
        </td>
        <td><span class="badge">${r.site}</span></td>
        <td class="num">${fmt(r.deposit)}</td>
        <td class="num">${fmt(r.withdrawal)}</td>
        <td class="num">${fmt(r.bonus)}</td>
        <td class="num">${fmt(r.forfeit)}</td>
        <td class="num">${fmt(r.resit)}</td>
        <td class="num">${r.member}</td>
        <td class="num"><b>${fmt(r.sales)}</b></td>
        <td class="actions">
          <span class="link" data-act="edit" data-id="${r.id}">Edit</span>
          <span class="link" data-act="delete" data-id="${r.id}">Delete</span>
        </td>
      `;
      txBody.appendChild(tr);
    }
    document.getElementById('txTable').classList.toggle('detail-on', detailOn);

    // delegate actions
    qsa('[data-act="edit"]').forEach(a=> a.onclick = ()=> editRecord(a.dataset.id));
    qsa('[data-act="delete"]').forEach(a=> a.onclick = ()=> deleteRecord(a.dataset.id));
  }

  // events
  siteSearch.addEventListener('input', render);
  clearSiteBtn.addEventListener('click', ()=>{ siteSearch.value=''; render(); });
  fromDate.addEventListener('change', render);
  toDate.addEventListener('change', render);

  sortBtn.addEventListener('click', ()=>{
    sortDesc = !sortDesc;
    sortBtn.textContent = sortDesc ? 'Date Descend' : 'Date Ascend';
    render();
  });

  detailBtn.addEventListener('click', ()=>{
    detailOn = !detailOn;
    detailBtn.textContent = detailOn ? 'Detail View: ON' : 'Detail View';
    render();
  });

  createBtn.addEventListener('click', ()=> openModal());
  closeModal.addEventListener('click', closeModalFn);
  modalBackdrop.addEventListener('click', (e)=>{ if (e.target===modalBackdrop) closeModalFn(); });

  saveModal.addEventListener('click', saveRecord);
  resetForm.addEventListener('click', ()=>{
    mSite.value=''; mDate.value=toInputValue(new Date());
    mDeposit.value=mWithdrawal.value=mBonus.value=mForfeit.value=mResit.value=mSales.value=0;
    mMember.value=0;
  });
  autoCalc.addEventListener('click', autoCalcSales);

  // helper: press Enter in site search focuses create (biar cepat input)
  siteSearch.addEventListener('keydown', e=>{
    if (e.key==='Enter'){ openModal(); setTimeout(()=> mSite.focus(), 50); }
  });

})();
</script>
</body>
</html>
