<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Notice</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: gold;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .sidebar {
      width: 100%;
      max-width: 600px;
      background-color: #1a1a1a;
      display: flex;
      flex-direction: column;
      border-right: 2px solid #333;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #333;
      background-color: #1668dc;
    }

    .sidebar-header h3 {
      margin: 0;
      font-size: 20px;
      color: white;
      text-align: center;
    }

    .btn-create {
      background-color: #1668dc;
      color: white;
      padding: 8px 12px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px 15px 0 auto;
    }

    .notice-scroll {
      padding: 15px;
      overflow-y: auto;
      flex-grow: 1;
    }
    .notice-row {
      display: flex;
      align-items: flex-start;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 6px;
    }

    .notice-row textarea {
      flex: 1;
      min-width: 200px;
      padding: 8px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background-color: #111;
      color: white;
      resize: vertical;
      min-height: 40px;
      word-break: break-word;
      border: 1px solid #1668dc;
    }

    .notice-row button {
      padding: 6px 10px;
      font-size: 13px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
      white-space: nowrap;
    }

    .btn-send { background-color: #1668dc; }
    .btn-edit { background-color: #999; }
    .btn-save { background-color: green; }
    .btn-delete { background-color: red; }
    
    button:hover {
   background-color: rgb(0 60 180 / 15%);
  color: white;
  transition: background-color 0.2s ease;
      box-shadow: 0 2px 6px rgba(255, 255, 255, 0.2);
}
button:active {
    color: rgba(255, 255, 255, 0.6);
}
    .main {
      flex-grow: 1;
      padding: 0;
    }
    .main-body {
    padding: 0 20px;
    }

    .main textarea {
      width: 99%;
      height: 700px;
      background-color: #222;
      color: white;
      font-size: 16px;
      border-radius: 6px;
      padding: 10px;
      border: 1px solid #1668dc;
      resize: none;
    }

    .main button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #1668dc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

  .main-header {
  background-color: #1668dc;
  padding: 20px;
  text-align: center;
  margin-bottom: 20px;
}

.main-header h2 {
  margin: 0;
  color: white;
  font-size: 30px;
}
  </style>
</head>
<body>

  <div class="sidebar">
    <div class="sidebar-header">
      <h3>Instant Messages</h3>
    </div>
    <button class="btn-create" onclick="createNotice()">+ Create</button>
    <div id="noticeList" class="notice-scroll"></div>
  </div>

  <div class="main">
  <div class="main-header">
    <h2>FLY NOTICE</h2>
  </div>

  <div class="main-body">
    <textarea id="pesan" placeholder="Type Your Notice HERE..." onkeydown="handleKeyPress(event)"></textarea><br>
    <button onclick="kirimPesan()">FLY NOTICE!</button>
  </div>
</div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
     const firebaseConfig = {
    apiKey: "AIzaSyBTeofEXBlzZmELtVAVZ-dctZmOGvf0Y34",
    authDomain: "notice-83ae5.firebaseapp.com",
    databaseURL: "https://notice-83ae5-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "notice-83ae5",
    storageBucket: "notice-83ae5.appspot.com",
    messagingSenderId: "268106877488",
    appId: "1:268106877488:web:798beadfe45104297e7bf5"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const encodedAllowedEmail = "NWc4OC5vZmZpY2FsQGdtYWlsLmNvbQ==";
  const allowedAdmin = atob(encodedAllowedEmail);
  const urlParams = new URLSearchParams(window.location.search);
  const adminEmail = atob(urlParams.get("admin") || "");

  let isCreating = false;
  let noticeData = [];
  const noticeList = document.getElementById('noticeList');

  function renderNotices() {
  noticeList.innerHTML = '';
  const sorted = [...noticeData].sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
  sorted.forEach(({ id, text, title }) => {
    const row = document.createElement('div');
    row.className = 'notice-row';

    
    const judulInput = document.createElement('input');
    judulInput.type = 'text';
    judulInput.value = title || '';
    judulInput.disabled = true;
    judulInput.placeholder = 'No Tittle...';
    judulInput.style.width = '100%';
    judulInput.style.padding = '6px';
    judulInput.style.marginBottom = '5px';
    judulInput.style.borderRadius = '4px';
    judulInput.style.border = '1px solid #1668dc';
    judulInput.style.backgroundColor = '#111';
    judulInput.style.color = 'rgb(34, 197, 94)';
    judulInput.style.fontWeight = 'bold';

    const textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.disabled = true;
    textarea.style.resize = 'none';

    const sendBtn = document.createElement('button');
    sendBtn.className = 'btn-send';
    sendBtn.textContent = 'Send';
    sendBtn.onclick = () => {
      document.getElementById("pesan").value = text;
      kirimPesan();
    };

    const editBtn = document.createElement('button');
    editBtn.className = 'btn-edit';
    editBtn.textContent = 'Edit';
    editBtn.onclick = () => {
      textarea.disabled = false;
      judulInput.disabled = false;
      editBtn.style.display = 'none';
      saveBtn.style.display = 'inline-block';
    };

    const saveBtn = document.createElement('button');
    saveBtn.className = 'btn-save';
    saveBtn.textContent = 'Save';
    saveBtn.style.display = 'none';
    saveBtn.onclick = () => {
      const newText = textarea.value.trim();
      const newTitle = judulInput.value.trim();
      if (!newText) return;
       db.ref("notifikasi/list/" + id).set({
        text: newText,
        title: newTitle,
        timestamp: Date.now()
      });
    };

    const delBtn = document.createElement('button');
    delBtn.className = 'btn-delete';
    delBtn.textContent = 'Delete';
    delBtn.onclick = () => {
      db.ref("notifikasi/list/" + id).remove();
    };

    row.appendChild(judulInput);
    row.appendChild(textarea);
    row.appendChild(sendBtn);
    row.appendChild(editBtn);
    row.appendChild(saveBtn);
    row.appendChild(delBtn);
    noticeList.appendChild(row);
  });
}

function createNotice() {
  if (isCreating) return;
  isCreating = true;

  const row = document.createElement('div');
  row.className = 'notice-row';

  
  const judulInput = document.createElement('input');
  judulInput.type = 'text';
  judulInput.placeholder = 'Tittle Message...';
  judulInput.style.width = '100%';
  judulInput.style.padding = '6px';
  judulInput.style.marginBottom = '5px';
  judulInput.style.borderRadius = '4px';
  judulInput.style.border = '1px solid #444';
  judulInput.style.backgroundColor = '#111';
  judulInput.style.color = 'gold';

  const textarea = document.createElement('textarea');
  textarea.placeholder = 'Type new message...';
  textarea.style.resize = 'none';

  const saveBtn = document.createElement('button');
  saveBtn.className = 'btn-save';
  saveBtn.textContent = 'Save';
  saveBtn.onclick = () => {
    const newText = textarea.value.trim();
    const newTitle = judulInput.value.trim();
    if (!newText) return;
    const newId = db.ref().child("notifikasi/list").push().key;
    db.ref("notifikasi/list/" + newId).set({
    text: newText,
    title: newTitle,
    timestamp: Date.now()
    });
    isCreating = false;
  };

  const cancelBtn = document.createElement('button');
  cancelBtn.className = 'btn-delete';
  cancelBtn.textContent = 'Cancel';
  cancelBtn.onclick = () => {
    isCreating = false;
    row.remove();
  };

  row.appendChild(judulInput);
  row.appendChild(textarea);
  row.appendChild(saveBtn);
  row.appendChild(cancelBtn);
  noticeList.prepend(row);
}

  function kirimPesan() {
    if (!adminEmail || adminEmail.toLowerCase() !== allowedAdmin.toLowerCase()) return;

    const teks = document.getElementById("pesan").value.trim();
    if (!teks) return;

    const data = {
      message: teks,
      timestamp: Date.now()
    };

    db.ref("notifikasi/pesanTerbaru").set(data).then(() => {
      document.getElementById("pesan").value = "";
    });
  }

  function handleKeyPress(event) {
    if (event.key === "Enter" && !event.ctrlKey) {
      event.preventDefault();
      kirimPesan();
    } else if (event.key === "Enter" && event.ctrlKey) {
      const textarea = document.getElementById("pesan");
      const cursorPos = textarea.selectionStart;
      const textBefore = textarea.value.substring(0, cursorPos);
      const textAfter = textarea.value.substring(cursorPos);
      textarea.value = textBefore + "\n" + textAfter;
      textarea.selectionStart = textarea.selectionEnd = cursorPos + 1;
      event.preventDefault();
    }
  }

  // Auto-load dari Firebase
  db.ref("notifikasi/list").on("value", (snapshot) => {
    const raw = snapshot.val() || {};
    noticeData = Object.entries(raw).map(([id, val]) => ({ id, ...val }));
    renderNotices();
  });
</script>
  </script>
</body>
</html>
