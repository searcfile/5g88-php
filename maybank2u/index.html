<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Transfer Receipt Builder</title>
  <style>
    :root{
      --green:#3b9b73;          /* dekat macam screenshot */
      --bg:#efefef;;
      --card:#fff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --danger:#e11d48;         /* amount merah */
      --shadow:0 10px 30px rgba(0,0,0,.10);
      --radius:10px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width: 1050px;
      margin: 18px auto;
      padding: 0 14px 26px;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 14px;
      align-items:start;
    }

    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
    }

    /* ====== LEFT: BUILDER PANEL ====== */
    .panel{
      background:var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel .ph{
      padding: 12px 14px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
    }
    .panel .ph h3{
      margin:0; font-size:14px; letter-spacing:.2px;
    }
    .panel .pb{ padding: 14px; }

    .field{ margin-bottom: 12px; }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    select,input{
      width:100%;
      height:40px;
      border:1px solid var(--line);
      border-radius:10px;
      padding: 0 12px;
      outline:none;
      background:#fff;
      font-size:14px;
    }
    input:focus,select:focus{
      border-color:#9ca3af;
      box-shadow: 0 0 0 3px rgba(17,24,39,.08);
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .hint{
      margin-top:6px;
      font-size:11px;
      color:var(--muted);
      line-height:1.3;
    }

    .btns{
      display:flex;
      gap:10px;
      margin-top: 8px;
    }
    button{
      height:42px;
      border-radius:12px;
      border:1px solid var(--line);
      padding: 0 14px;
      font-weight:700;
      cursor:pointer;
      background:#fff;
    }
    .btn-create{
      flex:1;
      background:#111827;
      color:#fff;
      border-color:#111827;
    }
    .btn-reset{
      width:120px;
      background:#fff;
      color:#111827;
    }
    button:active{ transform: translateY(1px); }

    .mini{
      margin-top:10px;
      padding:10px 12px;
      background:#f9fafb;
      border:1px dashed #e5e7eb;
      border-radius:12px;
      font-size:12px;
      color:#374151;
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

    /* ====== RIGHT: RECEIPT ====== */
    .receipt{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .topbar{
      background:#389a6e;
      color:#fff;
      padding: 14px 16px 35px;
      position:relative;
    }
    .topgrid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:12px;
      align-items:start;
    }
    .leftTitle{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .check{
      width:18px; height:18px;
      border-radius:50%;
      background: rgba(255,255,255,.25);
      display:grid; place-items:center;
      margin-top:2px;
      font-weight:900;
    }
    .t1{
      font-weight:400;
      font-size:13px;
      line-height:1.2;
      margin:0;
    }
    .sub{
      margin-top:6px;
      font-size:13px;
      opacity:.95;
    }
    .sub .acc{ font-weight:700; display:block; }
    .sub .amtTop{ font-weight:400; display:block; margin-top:2px; }

    .fav{
      background:#fff;
      color:#373737;
      border-radius: 6px;
      padding: 9px 12px;
      font-weight:700;
      border:1px solid #adadad;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
      white-space:nowrap;
    }
    .fav .star{ color:#f59e0b; font-size:16px; margin-top:-1px; }
    .divider{
      height:1px; background:var(--line);
      margin: 0;
    }

    .rows{
      padding: 10px 15px 12px;
    }
    .r{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:12px;
      padding: 6px 0;
      font-size:13px;
    }
    .r .l{ color:#171717; }
    .r .v{ color:#7d7d7d; }
    .r .v.strong{ color:#7d7d7d;}

    .footer{
      border-top: 1px solid var(--line);
      padding: 15px 16px;
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      font-size:13px;
      border-top: 6px solid #efefef;
    }
    .footer .totalLabel{ color:#171717; }
    .footer .totalVal{ font-weight:400; color:#da4747; }

    /* Holder masking (blur) */
    .maskWrap{ display:inline-flex; align-items:baseline; gap:0; }
    .maskFirst{
      font-weight:600;
      letter-spacing:.2px;
    }
    .maskBlur{
      display:inline-block;
      filter: blur(4px);
      opacity:.9;
      transform: translateZ(0);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- LEFT BUILDER -->
    <div class="panel">
      <div class="ph">
        <h3>Receipt Builder</h3>
        <span class="mono" style="font-size:12px;color:#6b7280;">localStorage ✅</span>
      </div>
      <div class="pb">
        <div class="field">
          <label>Recipient’s bank</label>
          <select id="bankSelect"></select>
        </div>

        <div class="field">
          <label>Effective date (text)</label>
          <input id="dateInput" type="text" placeholder="Today 06 Jan 2026" />
        </div>

        <div class="row2">
          <div class="field">
            <label>Reference ID prefix (4 digits)</label>
            <input id="refPrefix" type="text" inputmode="numeric" maxlength="4" placeholder="8292" />
            <div class="hint">Masuk 4 angka. Sistem auto buat jadi 10 angka bila Create.</div>
          </div>

          <div class="field">
            <label>Amount (RM)</label>
            <input id="amountInput" type="number" inputmode="decimal" min="0" step="0.01" placeholder="100.00" />
            <div class="hint">Amount atas & bawah ikut sama.</div>
          </div>
        </div>

        <div class="btns">
          <button class="btn-create" id="createBtn">Create</button>
          <button class="btn-reset" id="resetBtn">Reset</button>
        </div>

        <div class="mini">
          <div><b>Info:</b></div>
          <div>• Bank CIMB → auto generate <b>10 account number random</b> (10 digit) & pilih 1 untuk paparan.</div>
          <div>• Holder name auto: <b>CHRISTINA SHANDIE ANAK WILLIAM</b> (blur lepas Create).</div>
          <div>• Reference ID: <span class="mono">prefix4 + random6</span> → total 10 digit.</div>
        </div>
      </div>
    </div>

    <!-- RIGHT RECEIPT -->
    <div class="receipt" id="receiptCard">
      <div class="topbar">
        <div class="topgrid">
          <div>
            <div class="leftTitle">
              <div class="check">✓</div>
              <div>
                <p class="t1">Transfer To <span id="holderNameTitle">CHRISTINA SHANDIE ANAK WILLIAM</span></p>
                <div class="sub">
                  <span class="acc mono" id="accountNumber">7656696146</span>
                  <span class="amtTop" id="topAmount">RM 100.00</span>
                </div>
              </div>
            </div>
          </div>

          <div class="fav">
            <span class="star">☆</span>
            <span>Add to Favourite</span>
          </div>
        </div>
      </div>

      <div class="body">
        <hr class="divider">

        <div class="rows">
          <div class="r">
            <div class="l">Recipient's bank</div>
            <div class="v strong" id="bankValue">CIMB BANK BERHAD</div>
          </div>
          <div class="r">
            <div class="l">Transaction Type</div>
            <div class="v">Funds Transfer</div>
          </div>
          <div class="r">
            <div class="l">Transfer Mode</div>
            <div class="v">DuitNow Transfer</div>
          </div>
          <div class="r">
            <div class="l">Effective date</div>
            <div class="v" id="dateValue">Today 06 Jan 2026</div>
          </div>
          <div class="r">
            <div class="l">Recipient Reference</div>
            <div class="v">Payment</div>
          </div>
          <div class="r">
            <div class="l">Status</div>
            <div class="v">Successful</div>
          </div>
          <div class="r">
            <div class="l">Reference ID</div>
            <div class="v" id="refValue">8292256805</div>
          </div>
        </div>

        <div class="footer">
          <div class="totalLabel">Total Amount</div>
          <div class="totalVal" id="bottomAmount">RM 100.00</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================
    //  FULL RECEIPT BUILDER v1
    // ============================
    const LS_KEY = "receipt.builder.v1";

    const BANKS = [
      "CIMB BANK BERHAD",
      "MAYBANK",
      "PUBLIC BANK",
      "RHB BANK",
      "HONG LEONG BANK",
      "AMBANK",
      "BANK ISLAM",
      "HSBC BANK",
      "OCBC BANK",
      "UOB BANK"
    ];

    const DEFAULT_STATE = {
      bank: "CIMB BANK BERHAD",
      effectiveDate: "Today 06 Jan 2026",
      amount: 100.00,
      refPrefix4: "8292",
      referenceId10: "8292256805",
      holderName: "CHRISTINA SHANDIE ANAK WILLIAM",
      created: false,
      // store generated accounts per bank
      accountsByBank: {
        "CIMB BANK BERHAD": []
      },
      selectedAccountByBank: {}
    };

    // Elements
    const bankSelect   = document.getElementById("bankSelect");
    const dateInput    = document.getElementById("dateInput");
    const refPrefix    = document.getElementById("refPrefix");
    const amountInput  = document.getElementById("amountInput");
    const createBtn    = document.getElementById("createBtn");
    const resetBtn     = document.getElementById("resetBtn");

    const bankValue    = document.getElementById("bankValue");
    const dateValue    = document.getElementById("dateValue");
    const refValue     = document.getElementById("refValue");
    const accountNumber= document.getElementById("accountNumber");

    const holderNameTitle = document.getElementById("holderNameTitle");
    const topAmount    = document.getElementById("topAmount");
    const bottomAmount = document.getElementById("bottomAmount");

    // Helpers
    function rm(n){
      const v = Number(n || 0);
      return "RM " + v.toFixed(2);
    }

    function onlyDigits(str){ return String(str || "").replace(/\D/g, ""); }

    function randomDigits(len){
      let out = "";
      for(let i=0;i<len;i++) out += Math.floor(Math.random()*10);
      return out;
    }

    function makeReferenceId(prefix4){
      const p = onlyDigits(prefix4).slice(0,4).padEnd(4, "0");
      return p + randomDigits(6);
    }

    function makeAccount10(){
      // 10 digits, first digit not 0 to look more "real"
      const first = String(Math.floor(Math.random()*9)+1);
      return first + randomDigits(9);
    }

    function gen10Accounts(){
      const set = new Set();
      while(set.size < 10) set.add(makeAccount10());
      return Array.from(set);
    }

    function saveState(s){
      localStorage.setItem(LS_KEY, JSON.stringify(s));
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return structuredClone(DEFAULT_STATE);
        const parsed = JSON.parse(raw);

        // merge with defaults to avoid missing keys
        return {
          ...structuredClone(DEFAULT_STATE),
          ...parsed,
          accountsByBank: { ...(structuredClone(DEFAULT_STATE).accountsByBank), ...(parsed.accountsByBank || {}) },
          selectedAccountByBank: { ...(parsed.selectedAccountByBank || {}) }
        };
      }catch(e){
        return structuredClone(DEFAULT_STATE);
      }
    }

    function setHolderMasked(isMasked, fullName){
      const name = fullName || "";
      if(!isMasked){
        holderNameTitle.textContent = name;
        return;
      }
      // show first 2 letters, rest blur
      const first2 = name.trim().slice(0,2) || "Ch";
      const rest   = name.trim().slice(2) || "";

      holderNameTitle.innerHTML =
        `<span class="maskWrap">
          <span class="maskFirst">${escapeHtml(first2)}</span>
          <span class="maskBlur">${escapeHtml(rest)}</span>
        </span>`;
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function ensureAccountsForBank(state, bank){
      state.accountsByBank ||= {};
      state.selectedAccountByBank ||= {};

      if(!state.accountsByBank[bank] || state.accountsByBank[bank].length !== 10){
        state.accountsByBank[bank] = gen10Accounts();
      }
      if(!state.selectedAccountByBank[bank]){
        state.selectedAccountByBank[bank] = state.accountsByBank[bank][0];
      }
      return state;
    }

    function render(state){
      // Inputs
      bankSelect.value = state.bank;
      dateInput.value  = state.effectiveDate;
      refPrefix.value  = state.refPrefix4;
      amountInput.value= Number(state.amount || 0).toFixed(2);

      // Receipt values
      bankValue.textContent = state.bank;
      dateValue.textContent = state.effectiveDate;

      topAmount.textContent = rm(state.amount);
      bottomAmount.textContent = rm(state.amount);

      refValue.textContent = state.referenceId10;

      // account number (from bank)
      state = ensureAccountsForBank(state, state.bank);
      accountNumber.textContent = state.selectedAccountByBank[state.bank];

      // holder name mask only after Create
      setHolderMasked(!!state.created, state.holderName);

      saveState(state);
      return state;
    }

    // Init dropdown
    function initBanks(){
      bankSelect.innerHTML = BANKS.map(b => `<option value="${escapeHtml(b)}">${escapeHtml(b)}</option>`).join("");
    }

    // Live update amount/date/bank (but "mask name" only after Create)
    function attachLiveHandlers(){
      bankSelect.addEventListener("change", () => {
        state.bank = bankSelect.value;

        // regenerate 10 accounts ONLY when bank changed (if not exist)
        state = ensureAccountsForBank(state, state.bank);
        // pick first by default
        state.selectedAccountByBank[state.bank] = state.accountsByBank[state.bank][0];

        state.created = false; // optional: switching bank = back to uncreated view
        state = render(state);
      });

      dateInput.addEventListener("input", () => {
        state.effectiveDate = dateInput.value.trim() || DEFAULT_STATE.effectiveDate;
        state = render(state);
      });

      amountInput.addEventListener("input", () => {
        const v = Number(amountInput.value);
        state.amount = isNaN(v) ? 0 : Math.max(0, v);
        state = render(state);
      });

      refPrefix.addEventListener("input", () => {
        // keep only digits max 4
        const d = onlyDigits(refPrefix.value).slice(0,4);
        refPrefix.value = d;
        state.refPrefix4 = d || DEFAULT_STATE.refPrefix4;
        // don’t change referenceId until Create (to match your request)
        saveState(state);
      });

      createBtn.addEventListener("click", () => {
        // Build referenceId10
        state.referenceId10 = makeReferenceId(state.refPrefix4);
        // Ensure accounts exist
        state = ensureAccountsForBank(state, state.bank);

        // If bank is CIMB: auto show 1 of 10 (random choose), but keep the 10 list
        if(state.bank === "CIMB BANK BERHAD"){
          const list = state.accountsByBank[state.bank];
          state.selectedAccountByBank[state.bank] = list[Math.floor(Math.random() * list.length)];
        }

        state.created = true;
        state = render(state);
      });

      resetBtn.addEventListener("click", () => {
        localStorage.removeItem(LS_KEY);
        state = structuredClone(DEFAULT_STATE);
        // ensure default CIMB accounts
        state = ensureAccountsForBank(state, state.bank);
        state = render(state);
      });
    }

    // Boot
    initBanks();
    let state = loadState();

    // Ensure accounts for saved bank
    state = ensureAccountsForBank(state, state.bank);

    // If user already created before refresh, keep mask
    state = render(state);
    attachLiveHandlers();
  </script>
</body>
</html>
